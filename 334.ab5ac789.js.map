{"version":3,"file":"334.ab5ac789.js","sources":["webpack://nmemonica/./src/components/Form/SettingsStale.tsx"],"sourcesContent":["import { TrashIcon } from \"@primer/octicons-react\";\nimport { Suspense, useCallback, useMemo, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { NotReady } from \"./NotReady\";\nimport { getStaleSpaceRepKeys } from \"../../helper/gameHelper\";\nimport { useConnectKanji } from \"../../hooks/useConnectKanji\";\nimport { useConnectPhrase } from \"../../hooks/useConnectPhrase\";\nimport { useConnectVocabulary } from \"../../hooks/useConnectVocabulary\";\nimport { type AppDispatch } from \"../../slices\";\nimport { deleteMetaKanji } from \"../../slices/kanjiSlice\";\nimport { deleteMetaPhrase } from \"../../slices/phraseSlice\";\nimport { deleteMetaVocab } from \"../../slices/vocabularySlice\";\nimport { collapseExpandToggler } from \"../Pages/Settings\";\n\nexport default function SettingsStale() {\n  const dispatch = useDispatch<AppDispatch>();\n\n  const [sectionStaleSpaceRep, setSectionStaleSpaceRep] = useState(false);\n\n  const { vocabList: vocabulary, repetition: vRepetition } =\n    useConnectVocabulary();\n  const { phraseList: phrases, repetition: pRepetition } = useConnectPhrase();\n  const { kanjiList: kanji, repetition: kRepetition } = useConnectKanji();\n\n  const { keys: vKeys, list: vocabuStaleInfo } = useMemo(\n    () => getStaleSpaceRepKeys(vRepetition, vocabulary, \"[Stale Vocabulary]\"),\n    [vocabulary, vRepetition]\n  );\n  const { keys: pKeys, list: phraseStaleInfo } = useMemo(\n    () => getStaleSpaceRepKeys(pRepetition, phrases, \"[Stale Phrase]\"),\n    [phrases, pRepetition]\n  );\n  const { keys: kKeys, list: kanjiStaleInfo } = useMemo(\n    () => getStaleSpaceRepKeys(kRepetition, kanji, \"[Stale Kanji]\"),\n    [kanji, kRepetition]\n  );\n\n  const staleSpaceRepKeys = useMemo(\n    () => new Set([...vKeys, ...pKeys, ...kKeys]),\n    [vKeys, pKeys, kKeys]\n  );\n\n  const staleSpaceRepTerms = useMemo(\n    () =>\n      staleSpaceRep([\n        ...vocabuStaleInfo,\n        ...phraseStaleInfo,\n        ...kanjiStaleInfo,\n      ]),\n    [vocabuStaleInfo, phraseStaleInfo, kanjiStaleInfo]\n  );\n\n  // Stale uids still in repetition table\n  const oldUidKanji = useMemo(\n    () =>\n      kanjiStaleInfo.reduce<string[]>(\n        (acc, t) => (t.key === \"uid\" ? [...acc, t.uid] : acc),\n        []\n      ),\n    [kanjiStaleInfo]\n  );\n\n  const oldUidPhrase = useMemo(\n    () =>\n      phraseStaleInfo.reduce<string[]>(\n        (acc, t) => (t.key === \"uid\" ? [...acc, t.uid] : acc),\n        []\n      ),\n    [phraseStaleInfo]\n  );\n\n  const oldUidVocab = useMemo(\n    () =>\n      vocabuStaleInfo.reduce<string[]>(\n        (acc, t) => (t.key === \"uid\" ? [...acc, t.uid] : acc),\n        []\n      ),\n    [vocabuStaleInfo]\n  );\n\n  const phraseDelMetaCB = useCallback(() => {\n    if (oldUidPhrase.length > 0) {\n      void dispatch(deleteMetaPhrase(oldUidPhrase));\n    }\n  }, [dispatch, oldUidPhrase]);\n\n  const vocabDelMetaCB = useCallback(() => {\n    if (oldUidVocab.length > 0) {\n      void dispatch(deleteMetaVocab(oldUidVocab));\n    }\n  }, [dispatch, oldUidVocab]);\n\n  const kanjiDelMetaCB = useCallback(() => {\n    if (oldUidKanji.length > 0) {\n      void dispatch(deleteMetaKanji(oldUidKanji));\n    }\n  }, [dispatch, oldUidKanji]);\n\n  const el = (\n    <>\n      {(oldUidPhrase.length > 0 ||\n        oldUidVocab.length > 0 ||\n        oldUidKanji.length > 0) && (\n        <div className=\"mb-4\">\n          <span className=\"fs-5\">Stale Metadata UID</span>\n          <div className=\"d-flex flex-row justify-content-between\">\n            <div className=\"column-1\"></div>\n            <div className=\"column-2\">\n              <div className=\"setting-block\">\n                {oldUidPhrase.length > 0 && (\n                  <div className=\"d-flex flex-row justify-content-between\">\n                    <span>Phrase: {oldUidPhrase.length}</span>\n                    <div className=\"ps-4\" onClick={phraseDelMetaCB}>\n                      <TrashIcon\n                        className=\"clickable\"\n                        size=\"small\"\n                        aria-label=\"delete\"\n                      />\n                    </div>\n                  </div>\n                )}\n                {oldUidVocab.length > 0 && (\n                  <div className=\"d-flex flex-row justify-content-between\">\n                    <span>Vocabulary: {oldUidVocab.length}</span>\n                    <div className=\"ps-4\" onClick={vocabDelMetaCB}>\n                      <TrashIcon\n                        className=\"clickable\"\n                        size=\"small\"\n                        aria-label=\"delete\"\n                      />\n                    </div>\n                  </div>\n                )}\n                {oldUidKanji.length > 0 && (\n                  <div className=\"d-flex flex-row justify-content-between\">\n                    <span>Kanji: {oldUidKanji.length}</span>\n                    <div className=\"ps-4\" onClick={kanjiDelMetaCB}>\n                      <TrashIcon\n                        className=\"clickable\"\n                        size=\"small\"\n                        aria-label=\"delete\"\n                      />\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className=\"mb-2\">\n        <div className=\"d-flex justify-content-between\">\n          <span className=\"fs-5\">Stale Space Repetition</span>\n          {collapseExpandToggler(sectionStaleSpaceRep, setSectionStaleSpaceRep)}\n        </div>\n        <div>\n          {oldUidPhrase.length > 0 && (\n            <div onClick={phraseDelMetaCB}>\n              Stale Phrase Metadata: {oldUidPhrase.length}\n            </div>\n          )}\n          {oldUidVocab.length > 0 && (\n            <div onClick={vocabDelMetaCB}>\n              Stale Vocab Metadata: {oldUidVocab.length}\n            </div>\n          )}\n          {oldUidKanji.length > 0 && (\n            <div onClick={kanjiDelMetaCB}>\n              Stale Kanji Metadata: {oldUidKanji.length}\n            </div>\n          )}\n        </div>\n        <div className=\"px-4\">\n          <span>\n            {\"keys: \" + JSON.stringify(Array.from(staleSpaceRepKeys))}\n          </span>\n        </div>\n        {sectionStaleSpaceRep && (\n          <Suspense fallback={<NotReady addlStyle=\"failed-spacerep-view\" />}>\n            <div className=\"failed-spacerep-view container mt-2 p-0\">\n              {staleSpaceRepTerms}\n            </div>\n          </Suspense>\n        )}\n      </div>\n    </>\n  );\n\n  return el;\n}\n\n/**\n * Build JSX element listing stale items\n */\nfunction staleSpaceRep(terms: { key: string; uid: string; english: string }[]) {\n  return terms.reduce<React.JSX.Element[]>((a, text, i) => {\n    const separator = <hr key={`stale-meta-${text.uid}`} />;\n\n    const row = (\n      <div key={text.uid} className=\"row\">\n        <span className=\"col p-0\">{text.key}</span>\n        <span className=\"col p-0\">{text.english}</span>\n        <span className=\"col p-0 app-sm-fs-xx-small\">\n          <div>{text.uid}</div>\n        </span>\n      </div>\n    );\n\n    return a.length > 0 && i < terms.length\n      ? [...a, separator, row]\n      : [...a, row];\n  }, []);\n}\n"],"names":["SettingsStale","dispatch","useDispatch","sectionStaleSpaceRep","setSectionStaleSpaceRep","useState","vocabList","vocabulary","repetition","vRepetition","useConnectVocabulary","phraseList","phrases","pRepetition","useConnectPhrase","kanjiList","kanji","kRepetition","useConnectKanji","keys","vKeys","list","vocabuStaleInfo","useMemo","getStaleSpaceRepKeys","pKeys","phraseStaleInfo","kKeys","kanjiStaleInfo","staleSpaceRepKeys","Set","staleSpaceRepTerms","staleSpaceRep","terms","reduce","a","text","i","separator","uid","row","className","key","english","length","oldUidKanji","acc","t","oldUidPhrase","oldUidVocab","phraseDelMetaCB","useCallback","deleteMetaPhrase","vocabDelMetaCB","deleteMetaVocab","kanjiDelMetaCB","deleteMetaKanji","onClick","TrashIcon","size","collapseExpandToggler","JSON","stringify","Array","from","Suspense","fallback","NotReady","addlStyle"],"mappings":"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"}