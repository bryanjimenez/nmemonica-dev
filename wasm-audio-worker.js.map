{"version":3,"file":"wasm-audio-worker.js","sources":["webpack://nmemonica/./src/helper/urlHelper.ts","webpack://nmemonica/./src/helper/wasmWorkerHelper.ts","webpack://nmemonica/./node_modules/@nmemonica/voice-ja/voice_ja.js","webpack://nmemonica/./node_modules/@nmemonica/voice-ja/voice_ja_bg.js"],"sourcesContent":["/**\n * @returns the param\n */ export function getParam(baseUrl, param) {\n    const queryPart = baseUrl.includes(\"?\") ? baseUrl.split(\"?\")[1] : \"\";\n    const search = new URLSearchParams(queryPart);\n    const result = search.get(param);\n    return result;\n}\n/**\n * @returns a constructed url using the baseUrl and the params\n */ export function addParam(baseUrl, params) {\n    const [basePart, queryPart] = baseUrl.includes(\"?\") ? baseUrl.split(\"?\") : [\n        baseUrl,\n        \"\"\n    ];\n    const search = new URLSearchParams(queryPart);\n    for (const [key, value] of Object.entries(params)){\n        if (value !== undefined) {\n            search.append(key, value);\n        }\n    }\n    return [\n        basePart,\n        search.toString()\n    ].join(\"?\");\n}\n/**\n * @returns url without the given param or value\n * @param baseUrl\n * @param param to be removed\n */ export function removeParam(baseUrl, param) {\n    const [basePart, queryPart] = baseUrl.includes(\"?\") ? baseUrl.split(\"?\") : [\n        baseUrl,\n        \"\"\n    ];\n    const search = new URLSearchParams(queryPart);\n    search.delete(param);\n    return [\n        basePart,\n        search.toString()\n    ].join(\"?\");\n}\n","import { buildSpeech } from \"@nmemonica/voice-ja\";\nimport { getParam } from \"./urlHelper\";\nconst swSelf = globalThis.self;\nswSelf.addEventListener(\"message\", run);\nfunction run(event) {\n    console.log(\"worker: message\");\n    switch(event.data.eventType){\n        case \"Init\":\n            break;\n        default:\n            const { audioUrl, AbortController } = event.data;\n            const result = synthAudio(audioUrl, AbortController);\n            self.postMessage({\n                eventType: \"ran\",\n                audio: result\n            });\n            break;\n    }\n}\nfunction synthAudio(audioUrl, AbortController) {\n    const language = getParam(audioUrl.url, \"tl\");\n    const query = getParam(audioUrl.url, \"q\");\n    if (language === \"ja\" && query !== null) {\n        // TODO: use AbortController?\n        return buildSpeech(query);\n    }\n}\n","import * as wasm from \"./voice_ja_bg.wasm\";\nimport { __wbg_set_wasm } from \"./voice_ja_bg.js\";\n__wbg_set_wasm(wasm);\nexport * from \"./voice_ja_bg.js\";\nwasm.__wbindgen_start();\n","let wasm;\nexport function __wbg_set_wasm(val) {\n    wasm = val;\n}\nconst lTextDecoder = typeof TextDecoder === 'undefined' ? (0, module.require)('util').TextDecoder : TextDecoder;\nlet cachedTextDecoder = new lTextDecoder('utf-8', {\n    ignoreBOM: true,\n    fatal: true\n});\ncachedTextDecoder.decode();\nlet cachedUint8ArrayMemory0 = null;\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\nconst heap = new Array(128).fill(undefined);\nheap.push(undefined, null, true, false);\nlet heap_next = heap.length;\nfunction addHeapObject(obj) {\n    if (heap_next === heap.length) heap.push(heap.length + 1);\n    const idx = heap_next;\n    heap_next = heap[idx];\n    heap[idx] = obj;\n    return idx;\n}\nfunction getObject(idx) {\n    return heap[idx];\n}\nfunction dropObject(idx) {\n    if (idx < 132) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\nfunction takeObject(idx) {\n    const ret = getObject(idx);\n    dropObject(idx);\n    return ret;\n}\nlet WASM_VECTOR_LEN = 0;\nconst lTextEncoder = typeof TextEncoder === 'undefined' ? (0, module.require)('util').TextEncoder : TextEncoder;\nlet cachedTextEncoder = new lTextEncoder('utf-8');\nconst encodeString = typeof cachedTextEncoder.encodeInto === 'function' ? function(arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n} : function(arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n};\nfunction passStringToWasm0(arg, malloc, realloc) {\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n    const mem = getUint8ArrayMemory0();\n    let offset = 0;\n    for(; offset < len; offset++){\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\nlet cachedDataViewMemory0 = null;\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer.detached === true || cachedDataViewMemory0.buffer.detached === undefined && cachedDataViewMemory0.buffer !== wasm.memory.buffer) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\nfunction getArrayU8FromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return getUint8ArrayMemory0().subarray(ptr / 1, ptr / 1 + len);\n}\n/**\n* @param {string} query\n* @returns {Uint8Array}\n*/ export function buildSpeech(query) {\n    try {\n        const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);\n        const ptr0 = passStringToWasm0(query, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        wasm.buildSpeech(retptr, ptr0, len0);\n        var r0 = getDataViewMemory0().getInt32(retptr + 4 * 0, true);\n        var r1 = getDataViewMemory0().getInt32(retptr + 4 * 1, true);\n        var r2 = getDataViewMemory0().getInt32(retptr + 4 * 2, true);\n        var r3 = getDataViewMemory0().getInt32(retptr + 4 * 3, true);\n        if (r3) {\n            throw takeObject(r2);\n        }\n        var v2 = getArrayU8FromWasm0(r0, r1).slice();\n        wasm.__wbindgen_free(r0, r1 * 1, 1);\n        return v2;\n    } finally{\n        wasm.__wbindgen_add_to_stack_pointer(16);\n    }\n}\n/**\n*/ export function run() {\n    wasm.run();\n}\nexport function __wbindgen_string_new(arg0, arg1) {\n    const ret = getStringFromWasm0(arg0, arg1);\n    return addHeapObject(ret);\n}\nexport function __wbg_new_abda76e883ba8a5f() {\n    const ret = new Error();\n    return addHeapObject(ret);\n}\nexport function __wbg_stack_658279fe44541cf6(arg0, arg1) {\n    const ret = getObject(arg1).stack;\n    const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n    getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n}\nexport function __wbg_error_f851667af71bcfc6(arg0, arg1) {\n    let deferred0_0;\n    let deferred0_1;\n    try {\n        deferred0_0 = arg0;\n        deferred0_1 = arg1;\n        console.error(getStringFromWasm0(arg0, arg1));\n    } finally{\n        wasm.__wbindgen_free(deferred0_0, deferred0_1, 1);\n    }\n}\nexport function __wbindgen_object_drop_ref(arg0) {\n    takeObject(arg0);\n}\n"],"names":["getParam","baseUrl","param","search","URLSearchParams","includes","split","get","swSelf","globalThis","self","addEventListener","event","console","log","data","eventType","audioUrl","AbortController","result","synthAudio","language","url","query","postMessage","audio","wasm","__wbg_set_wasm","val","cachedTextDecoder","TextDecoder","module","require","ignoreBOM","fatal","decode","cachedUint8ArrayMemory0","getUint8ArrayMemory0","byteLength","Uint8Array","memory","buffer","getStringFromWasm0","ptr","len","subarray","heap","Array","fill","undefined","push","heap_next","length","addHeapObject","obj","idx","getObject","takeObject","ret","WASM_VECTOR_LEN","cachedTextEncoder","TextEncoder","encodeString","encodeInto","arg","view","buf","encode","set","read","written","passStringToWasm0","malloc","realloc","mem","offset","code","charCodeAt","slice","cachedDataViewMemory0","getDataViewMemory0","detached","DataView","buildSpeech","retptr","__wbindgen_add_to_stack_pointer","ptr0","__wbindgen_malloc","__wbindgen_realloc","len0","r0","getInt32","r1","r2","v2","getArrayU8FromWasm0","__wbindgen_free","__wbindgen_string_new","arg0","arg1","__wbg_new_abda76e883ba8a5f","Error","__wbg_stack_658279fe44541cf6","ptr1","stack","len1","setInt32","__wbg_error_f851667af71bcfc6","deferred0_0","deferred0_1","error","__wbindgen_object_drop_ref"],"mappings":"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"}