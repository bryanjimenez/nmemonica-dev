{"version":3,"file":"voice-worker.js","sources":["webpack://nmemonica/./src/helper/urlHelper.ts?3cc6","webpack://nmemonica/./src/worker/voiceWorker.ts","webpack://nmemonica/./node_modules/@nmemonica/voice-ja/voice_ja.js","webpack://nmemonica/./node_modules/@nmemonica/voice-ja/voice_ja_bg.js"],"sourcesContent":["/**\n * @returns the param\n */ export function getParam(baseUrl, param) {\n    const queryPart = baseUrl.includes(\"?\") ? baseUrl.split(\"?\")[1] : \"\";\n    const search = new URLSearchParams(queryPart);\n    const result = search.get(param);\n    return result;\n}\n/**\n * @returns a constructed url using the baseUrl and the params\n */ export function addParam(baseUrl, params) {\n    const [basePart, queryPart] = baseUrl.includes(\"?\") ? baseUrl.split(\"?\") : [\n        baseUrl,\n        \"\"\n    ];\n    const search = new URLSearchParams(queryPart);\n    for (const [key, value] of Object.entries(params)){\n        if (value !== undefined) {\n            search.append(key, value);\n        }\n    }\n    return [\n        basePart,\n        search.toString()\n    ].join(\"?\");\n}\n/**\n * @returns url without the given param or value\n * @param baseUrl\n * @param param to be removed\n */ export function removeParam(baseUrl, param) {\n    const [basePart, queryPart] = baseUrl.includes(\"?\") ? baseUrl.split(\"?\") : [\n        baseUrl,\n        \"\"\n    ];\n    const search = new URLSearchParams(queryPart);\n    search.delete(param);\n    return [\n        basePart,\n        search.toString()\n    ].join(\"?\");\n}\n","import { buildSpeech as jBuildSpeech } from \"@nmemonica/voice-ja\";\nimport voice_model_deep from \"../../res/models/hts_voice_nitech_jp_atr503_m001-1.05/nitech_jp_atr503_m001.htsvoice\";\nimport voice_model_angry from \"../../res/models/tohoku-f01/tohoku-f01-angry.htsvoice\";\nimport voice_model_happy from \"../../res/models/tohoku-f01/tohoku-f01-happy.htsvoice\";\nimport voice_model_neutral from \"../../res/models/tohoku-f01/tohoku-f01-neutral.htsvoice\";\nimport voice_model_sad from \"../../res/models/tohoku-f01/tohoku-f01-sad.htsvoice\";\nimport { getParam } from \"../helper/urlHelper\";\nconst swSelf = globalThis.self;\nswSelf.addEventListener(\"message\", messageHandler);\nfunction messageHandler(event) {\n    const data = event.data;\n    const { audioUrl, AbortController, japaneseVoice } = data;\n    const language = getParam(audioUrl.url, \"tl\");\n    const query = getParam(audioUrl.url, \"q\");\n    if (language === \"ja\" && query !== null && typeof jBuildSpeech === \"function\") {\n        let voice_model;\n        switch(japaneseVoice){\n            case \"happy\":\n                voice_model = voice_model_happy;\n                break;\n            case \"angry\":\n                voice_model = voice_model_angry;\n                break;\n            case \"sad\":\n                voice_model = voice_model_sad;\n                break;\n            case \"deep\":\n                voice_model = voice_model_deep;\n                break;\n            default:\n                voice_model = voice_model_neutral;\n                break;\n        }\n        void fetch(voice_model).then((res)=>res.arrayBuffer()).then((model_buf)=>{\n            const result = jBuildSpeech(query, new Uint8Array(model_buf));\n            self.postMessage(result);\n        });\n    }\n}\n","import * as wasm from \"./voice_ja_bg.wasm\";\nimport { __wbg_set_wasm } from \"./voice_ja_bg.js\";\n__wbg_set_wasm(wasm);\nexport * from \"./voice_ja_bg.js\";\nwasm.__wbindgen_start();\n","let wasm;\nexport function __wbg_set_wasm(val) {\n    wasm = val;\n}\nconst lTextDecoder = typeof TextDecoder === 'undefined' ? (0, module.require)('util').TextDecoder : TextDecoder;\nlet cachedTextDecoder = new lTextDecoder('utf-8', {\n    ignoreBOM: true,\n    fatal: true\n});\ncachedTextDecoder.decode();\nlet cachedUint8ArrayMemory0 = null;\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\nconst heap = new Array(128).fill(undefined);\nheap.push(undefined, null, true, false);\nlet heap_next = heap.length;\nfunction addHeapObject(obj) {\n    if (heap_next === heap.length) heap.push(heap.length + 1);\n    const idx = heap_next;\n    heap_next = heap[idx];\n    heap[idx] = obj;\n    return idx;\n}\nfunction getObject(idx) {\n    return heap[idx];\n}\nfunction dropObject(idx) {\n    if (idx < 132) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\nfunction takeObject(idx) {\n    const ret = getObject(idx);\n    dropObject(idx);\n    return ret;\n}\nlet WASM_VECTOR_LEN = 0;\nconst lTextEncoder = typeof TextEncoder === 'undefined' ? (0, module.require)('util').TextEncoder : TextEncoder;\nlet cachedTextEncoder = new lTextEncoder('utf-8');\nconst encodeString = typeof cachedTextEncoder.encodeInto === 'function' ? function(arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n} : function(arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n};\nfunction passStringToWasm0(arg, malloc, realloc) {\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n    const mem = getUint8ArrayMemory0();\n    let offset = 0;\n    for(; offset < len; offset++){\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\nlet cachedDataViewMemory0 = null;\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer.detached === true || cachedDataViewMemory0.buffer.detached === undefined && cachedDataViewMemory0.buffer !== wasm.memory.buffer) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\nfunction getArrayU8FromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return getUint8ArrayMemory0().subarray(ptr / 1, ptr / 1 + len);\n}\n/**\n* @param {string} query\n* @param {Uint8Array} voice_model\n* @returns {Uint8Array}\n*/ export function buildSpeech(query, voice_model) {\n    try {\n        const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);\n        const ptr0 = passStringToWasm0(query, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ptr1 = passArray8ToWasm0(voice_model, wasm.__wbindgen_malloc);\n        const len1 = WASM_VECTOR_LEN;\n        wasm.buildSpeech(retptr, ptr0, len0, ptr1, len1);\n        var r0 = getDataViewMemory0().getInt32(retptr + 4 * 0, true);\n        var r1 = getDataViewMemory0().getInt32(retptr + 4 * 1, true);\n        var r2 = getDataViewMemory0().getInt32(retptr + 4 * 2, true);\n        var r3 = getDataViewMemory0().getInt32(retptr + 4 * 3, true);\n        if (r3) {\n            throw takeObject(r2);\n        }\n        var v3 = getArrayU8FromWasm0(r0, r1).slice();\n        wasm.__wbindgen_free(r0, r1 * 1, 1);\n        return v3;\n    } finally{\n        wasm.__wbindgen_add_to_stack_pointer(16);\n    }\n}\n/**\n*/ export function run() {\n    wasm.run();\n}\nexport function __wbindgen_string_new(arg0, arg1) {\n    const ret = getStringFromWasm0(arg0, arg1);\n    return addHeapObject(ret);\n}\nexport function __wbg_new_abda76e883ba8a5f() {\n    const ret = new Error();\n    return addHeapObject(ret);\n}\nexport function __wbg_stack_658279fe44541cf6(arg0, arg1) {\n    const ret = getObject(arg1).stack;\n    const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n    getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n}\nexport function __wbg_error_f851667af71bcfc6(arg0, arg1) {\n    let deferred0_0;\n    let deferred0_1;\n    try {\n        deferred0_0 = arg0;\n        deferred0_1 = arg1;\n        console.error(getStringFromWasm0(arg0, arg1));\n    } finally{\n        wasm.__wbindgen_free(deferred0_0, deferred0_1, 1);\n    }\n}\nexport function __wbindgen_object_drop_ref(arg0) {\n    takeObject(arg0);\n}\n"],"names":["getParam","baseUrl","param","search","URLSearchParams","includes","split","get","swSelf","globalThis","self","addEventListener","event","audioUrl","AbortController","japaneseVoice","data","language","url","query","voice_model","fetch","then","res","arrayBuffer","model_buf","result","Uint8Array","postMessage","wasm","__wbg_set_wasm","val","cachedTextDecoder","TextDecoder","module","require","ignoreBOM","fatal","decode","cachedUint8ArrayMemory0","getUint8ArrayMemory0","byteLength","memory","buffer","getStringFromWasm0","ptr","len","subarray","heap","Array","fill","undefined","push","heap_next","length","addHeapObject","obj","idx","getObject","takeObject","ret","WASM_VECTOR_LEN","cachedTextEncoder","TextEncoder","encodeString","encodeInto","arg","view","buf","encode","set","read","written","passStringToWasm0","malloc","realloc","mem","offset","code","charCodeAt","slice","cachedDataViewMemory0","getDataViewMemory0","detached","DataView","buildSpeech","retptr","__wbindgen_add_to_stack_pointer","ptr0","__wbindgen_malloc","__wbindgen_realloc","len0","ptr1","passArray8ToWasm0","len1","r0","getInt32","r1","r2","v3","getArrayU8FromWasm0","__wbindgen_free","__wbindgen_string_new","arg0","arg1","__wbg_new_abda76e883ba8a5f","Error","__wbg_stack_658279fe44541cf6","stack","setInt32","__wbg_error_f851667af71bcfc6","deferred0_0","deferred0_1","console","error","__wbindgen_object_drop_ref"],"mappings":"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"}