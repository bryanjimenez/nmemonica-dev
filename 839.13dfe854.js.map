{"version":3,"file":"839.13dfe854.js","sources":["webpack://nmemonica/./src/components/Form/SettingsFailedFurigana.tsx"],"sourcesContent":["import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { Suspense, useEffect, useMemo } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { NotReady } from \"./NotReady\";\nimport { JapaneseText, furiganaParseRetry } from \"../../helper/JapaneseText\";\nimport { useConnectPhrase } from \"../../hooks/useConnectPhrase\";\nimport { useConnectVocabulary } from \"../../hooks/useConnectVocabulary\";\nimport { getPhrase } from \"../../slices/phraseSlice\";\nimport { getVocabulary } from \"../../slices/vocabularySlice\";\nexport default function SettingsFailedFurigana() {\n    const dispatch = useDispatch();\n    const { vocabList: vocabulary } = useConnectVocabulary();\n    const { phraseList: phrases } = useConnectPhrase();\n    useEffect(()=>{\n        if (vocabulary.length === 0) {\n            void dispatch(getVocabulary());\n        }\n        if (phrases.length === 0) {\n            void dispatch(getPhrase());\n        }\n    }, []);\n    const failedFurigana = useMemo(()=>failedFuriganaList([\n            ...phrases,\n            ...vocabulary\n        ]), [\n        vocabulary,\n        phrases\n    ]);\n    const el = /*#__PURE__*/ _jsx(_Fragment, {\n        children: failedFurigana.length > 0 && /*#__PURE__*/ _jsxs(\"div\", {\n            className: \"mb-2\",\n            children: [\n                /*#__PURE__*/ _jsx(\"span\", {\n                    className: \"fs-3 fw-light\",\n                    children: \"Failed Furigana Parse\"\n                }),\n                /*#__PURE__*/ _jsx(Suspense, {\n                    fallback: /*#__PURE__*/ _jsx(NotReady, {\n                        addlStyle: \"failed-furigana-view\"\n                    }),\n                    children: /*#__PURE__*/ _jsx(\"div\", {\n                        className: \"failed-furigana-view container mt-2 p-0\",\n                        children: failedFurigana\n                    })\n                })\n            ]\n        })\n    });\n    return el;\n}\nfunction failedFuriganaList(terms) {\n    return terms.reduce((a, text, i)=>{\n        const t = JapaneseText.parse(text);\n        if (t.hasFurigana()) {\n            try {\n                furiganaParseRetry(t.getPronunciation(), t.getSpellingRAW());\n            } catch (e) {\n                if (e instanceof Error && \"cause\" in e) {\n                    const errData = e.cause;\n                    if (errData.code === \"ParseError\" || errData.code === \"InputError\") {\n                        const separator = /*#__PURE__*/ _jsx(\"hr\", {}, `parse-err-sep-${text.uid}`);\n                        const row = /*#__PURE__*/ _jsxs(\"div\", {\n                            className: \"row\",\n                            children: [\n                                /*#__PURE__*/ _jsx(\"span\", {\n                                    className: \"col p-0\",\n                                    children: t.toHTML({\n                                        showError: false\n                                    })\n                                }),\n                                /*#__PURE__*/ _jsx(\"span\", {\n                                    className: \"col p-0\",\n                                    children: text.english\n                                }),\n                                /*#__PURE__*/ _jsxs(\"span\", {\n                                    className: \"col p-0 app-sm-fs-xx-small\",\n                                    children: [\n                                        /*#__PURE__*/ _jsx(\"div\", {\n                                            children: e.message\n                                        }),\n                                        /*#__PURE__*/ _jsx(\"div\", {\n                                            children: errData.info ? JSON.stringify(errData.info) : \"\"\n                                        })\n                                    ]\n                                })\n                            ]\n                        }, `parse-err-${text.uid}`);\n                        return a.length > 0 && i < terms.length - 1 ? [\n                            ...a,\n                            separator,\n                            row\n                        ] : [\n                            ...a,\n                            row\n                        ];\n                    }\n                }\n            }\n        }\n        return a;\n    }, []);\n}\n"],"names":["SettingsFailedFurigana","dispatch","vocabList","vocabulary","phraseList","phrases","useEffect","length","failedFurigana","useMemo","failedFuriganaList","terms","reduce","a","text","i","t","hasFurigana","getPronunciation","getSpellingRAW","e","Error","errData","cause","code","separator","uid","row","className","children","toHTML","showError","english","message","info","JSON","stringify","Suspense","fallback","addlStyle"],"mappings":"gQASe,SAASA,IACpB,IAAMC,EAAW,WACX,CAAEC,UAAWC,CAAU,CAAE,CAAG,UAC5B,CAAEC,WAAYC,CAAO,CAAE,CAAG,UAChC,KAAAC,SAAA,EAAU,KACoB,IAAtBH,EAAWI,MAAM,EACZN,EAAS,YAEK,IAAnBI,EAAQE,MAAM,EACTN,EAAS,WAEtB,EAAG,EAAE,EACL,IAAMO,EAAiB,KAAAC,OAAA,EAAQ,IAAIC,AA6BvC,UAA4BC,CAAK,EAC7B,OAAOA,EAAMC,MAAM,CAAC,CAACC,EAAGC,EAAMC,KAC1B,IAAMC,EAAI,UAAkB,CAACF,GAC7B,GAAIE,EAAEC,WAAW,GACb,GAAI,CACA,SAAmBD,EAAEE,gBAAgB,GAAIF,EAAEG,cAAc,GAC7D,CAAE,MAAOC,EAAG,CACR,GAAIA,aAAaC,OAAS,UAAWD,EAAG,CACpC,IAAME,EAAUF,EAAEG,KAAK,CACvB,GAAID,AAAiB,eAAjBA,EAAQE,IAAI,EAAqBF,AAAiB,eAAjBA,EAAQE,IAAI,CAAmB,CAChE,IAAMC,EAA0B,UAAK,KAAM,CAAC,EAAG,CAAC,cAAc,EAAEX,EAAKY,GAAG,CAAC,CAAC,EACpEC,EAAoB,WAAM,MAAO,CACnCC,UAAW,MACXC,SAAU,CACQ,UAAK,OAAQ,CACvBD,UAAW,UACXC,SAAUb,EAAEc,MAAM,CAAC,CACfC,UAAW,EACf,EACJ,GACc,UAAK,OAAQ,CACvBH,UAAW,UACXC,SAAUf,EAAKkB,OAAO,AAC1B,GACc,WAAM,OAAQ,CACxBJ,UAAW,6BACXC,SAAU,CACQ,UAAK,MAAO,CACtBA,SAAUT,EAAEa,OAAO,AACvB,GACc,UAAK,MAAO,CACtBJ,SAAUP,EAAQY,IAAI,CAAGC,KAAKC,SAAS,CAACd,EAAQY,IAAI,EAAI,EAC5D,GACH,AACL,GACH,AACL,EAAG,CAAC,UAAU,EAAEpB,EAAKY,GAAG,CAAC,CAAC,EAC1B,OAAOb,EAAEN,MAAM,CAAG,GAAKQ,EAAIJ,EAAMJ,MAAM,CAAG,EAAI,IACvCM,EACHY,EACAE,EACH,CAAG,IACGd,EACHc,EACH,AACL,CACJ,CACJ,CAEJ,OAAOd,CACX,EAAG,EAAE,CACT,GAhF0D,IAC3CR,KACAF,EACN,EAAG,CACJA,EACAE,EACH,EAqBD,MApByB,UAAK,UAAS,CAAE,CACrCwB,SAAUrB,EAAeD,MAAM,CAAG,GAAmB,WAAM,MAAO,CAC9DqB,UAAW,OACXC,SAAU,CACQ,UAAK,OAAQ,CACvBD,UAAW,gBACXC,SAAU,uBACd,GACc,UAAK,EAAAQ,QAAQ,CAAE,CACzBC,SAAwB,UAAK,GAAQ,CAAE,CACnCC,UAAW,sBACf,GACAV,SAAwB,UAAK,MAAO,CAChCD,UAAW,0CACXC,SAAUrB,CACd,EACJ,GACH,AACL,EACJ,EAEJ,C"}