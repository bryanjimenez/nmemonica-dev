(self.webpackChunknmemonica=self.webpackChunknmemonica||[]).push([["625"],{68152:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return E}});var l=a("17581"),t=a("15764"),i=a("50098"),n=a("18554"),c=a.n(n),r=a("74288"),d=a("75092"),o=a("69017"),u=a("92820"),m=a("86484"),x=a("35018"),h=a("71959"),b=a("90210"),p=a("27068"),j=a("97453"),f=a("96486"),v=a("45080"),g=a("1536"),S=a("31980"),N=a("40257"),k=a("97648"),y=a("57390"),D=a("12960"),C=a("84798"),w=a("87519");let I=(0,r.lazy)(()=>a.e("483").then(a.bind(a,"71420"))),z=(0,r.lazy)(()=>a.e("382").then(a.bind(a,"19419")));function E(){let e=(0,d.useDispatch)(),{cookies:s,debug:a,localServiceURL:n,lastImport:E}=(0,v.useConnectSetting)(),[L,R]=(0,r.useState)(!1),[T,B]=(0,r.useState)(!1),[O,P]=(0,r.useState)(!1),[U,F]=(0,r.useState)(!1),[H,K]=(0,r.useState)(!1),[G,W]=(0,r.useState)(!1),[$,A]=(0,r.useState)(!1),[J,M]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=setTimeout(()=>{M(!0)},500);return()=>{clearTimeout(e)}},[]);let V=(0,r.useCallback)(()=>{if(!confirm("User edited datasets will be overwritten"))return;let s=(0,o.getExternalSourceType)(n);s===o.ExternalSourceType.Unset?e((0,g.setLocalDataEdited)(!1)):e((0,g.setLocalDataEdited)(!0)),e((0,C.importDatasets)()).unwrap().then(e=>(0,x.openIDB)().then(s=>(0,x.putIDBItem)({db:s,store:x.IDBStores.WORKBOOK},{key:"0",workbook:e}))).then(()=>{e((0,w.clearVocabulary)()),e((0,y.clearPhrases)()),e((0,S.clearKanji)()),e((0,k.clearParticleGame)()),e((0,N.clearOpposites)()),F(!0),e((0,g.setLastImport)(`${["Reset","Local","GitHub"][s]}: ${new Date().toJSON()}`))})},[e,n]),q=(0,r.useCallback)(()=>{confirm("User settings will be overwritten")&&e((0,g.importSettings)()).then(()=>{K(!0)})},[e]),Q=(0,r.useCallback)(()=>{if(!confirm("Back up:\n - Datasets\n - Settings\n\nto local service?"))return;let s=new Promise((s,a)=>{let l;try{l=(0,j.getLocalStorageSettings)(h.localStorageKey)}catch(s){e((0,g.logger)("Failed settings backup",D.DebugLevel.ERROR))}if(!l){s();return}(0,C.saveSettingsLocalService)(l,n).then(()=>s).catch(()=>a)});Promise.all([s,e((0,C.getDatasets)()).unwrap().then(e=>e.map(e=>(0,C.saveSheetLocalService)(e,n))).then(e=>Promise.all(e))]).then(()=>{P(!0)})},[e,n]),X=(0,r.useCallback)(e=>{R(e)},[]),Y=(0,r.useCallback)(e=>{B(e),!0!==e&&(F(null),P(null))},[]);return(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mt-3 mb-1"}),(0,l.jsxs)("div",{className:"d-flex flex-row justify-content-between",children:[(0,l.jsx)("div",{className:"column-1 mb-2 me-sm-2"}),(0,l.jsx)("div",{className:"column-2",children:(0,l.jsxs)("div",{className:"ps-2 d-flex flex-column align-items-end",children:[(0,l.jsx)("div",{className:"setting-block mb-2",children:(0,l.jsx)(m.default,{disabled:!s,active:a>D.DebugLevel.OFF,action:(0,b.buildAction)(e,g.debugToggled),color:"default",statusText:(0,p.labelOptions)(a,["Debug","Debug Error","Debug Warn","Debug"])})}),(0,l.jsxs)("div",{className:c()({"d-flex justify-content-end mb-2":!0,"disabled-color":$}),children:[(0,l.jsx)("p",{id:"hard-refresh",className:c()({"text-right":!0,"disabled-color":!s}),children:"Hard Refresh"}),(0,l.jsx)("div",{className:c()({"spin-a-bit":G,"disabled-color":!s,clickable:s}),style:{height:"24px"},"aria-labelledby":"hard-refresh",onClick:s?()=>{W(!0),A(!1),setTimeout(()=>{G&&(W(!1),A(!0))},3e3),(0,f.swMessageDoHardRefresh)()}:void 0,children:(0,l.jsx)(i.SyncIcon,{size:24,"aria-label":"Hard Refresh"})})]})," "]})})]}),(0,l.jsx)("h3",{className:"mt-3 mb-1 fw-light",children:"External Data Source"}),(0,l.jsxs)("div",{className:"d-flex flex-column flex-sm-row justify-content-between",children:[(0,l.jsx)("div",{className:"column-1 mb-2 me-sm-2",children:(0,l.jsx)("div",{className:"mt-2 mb-2",children:[(0,l.jsx)("div",{children:"Recent import history:"},"label"),...E.map(e=>(0,l.jsx)("div",{className:"pt-1",children:e},e))]})}),(0,l.jsxs)("div",{className:"column-2",children:[(0,l.jsx)("div",{className:"mb-2",children:(0,l.jsx)(o.default,{onChangeInput:X,onChangeTrust:Y})}),(0,l.jsxs)("div",{className:"d-flex justify-content-center",children:[(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Import Datasets",variant:"outlined",size:"small",disabled:L||""===n||!0!==T||!0===U,onClick:V,children:[!0===U?(0,l.jsx)(i.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(i.DownloadIcon,{size:"small",className:"pe-1"}),"Datasets"]})}),(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Import User Configuration",variant:"outlined",size:"small",disabled:(0,o.getExternalSourceType)(n)!==o.ExternalSourceType.LocalService||L||""===n||!0!==T||!0===H,onClick:q,children:[!0===H?(0,l.jsx)(i.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(i.DownloadIcon,{size:"small",className:"pe-1"}),"Config"]})}),(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Backup Datasets",variant:"outlined",size:"small",disabled:(0,o.getExternalSourceType)(n)!==o.ExternalSourceType.LocalService||L||""===n||!0!==T||!0===O,onClick:Q,children:[!0===O?(0,l.jsx)(i.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(i.UploadIcon,{size:"small",className:"pe-1"}),"Backup"]})})]})]})]}),(0,l.jsx)("div",{className:"mt-4",children:J?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Suspense,{fallback:(0,l.jsx)(u.NotReady,{addlStyle:"failed-spacerep-view"}),children:(0,l.jsx)(I,{})}),(0,l.jsx)(r.Suspense,{fallback:(0,l.jsx)(u.NotReady,{addlStyle:"failed-furigana-view"}),children:(0,l.jsx)(z,{})})]}):(0,l.jsx)(u.NotReady,{text:"Loading failed details ..."})})]})}}}]);
//# sourceMappingURL=625.8acdd615.js.map