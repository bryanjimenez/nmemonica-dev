{"version":3,"file":"515.71004f61.js","sources":["webpack://nmemonica/./src/components/Form/SettingsStale.tsx"],"sourcesContent":["import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { TrashIcon } from \"@primer/octicons-react\";\nimport { Suspense, useCallback, useMemo, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { NotReady } from \"./NotReady\";\nimport { getStaleSpaceRepKeys } from \"../../helper/gameHelper\";\nimport { useConnectKanji } from \"../../hooks/useConnectKanji\";\nimport { useConnectPhrase } from \"../../hooks/useConnectPhrase\";\nimport { useConnectVocabulary } from \"../../hooks/useConnectVocabulary\";\nimport { deleteMetaKanji } from \"../../slices/kanjiSlice\";\nimport { deleteMetaPhrase } from \"../../slices/phraseSlice\";\nimport { deleteMetaVocab } from \"../../slices/vocabularySlice\";\nimport { collapseExpandToggler } from \"../Pages/Settings\";\nexport default function SettingsStale() {\n    const dispatch = useDispatch();\n    const [sectionStaleSpaceRep, setSectionStaleSpaceRep] = useState(false);\n    const { vocabList: vocabulary, repetition: vRepetition } = useConnectVocabulary();\n    const { phraseList: phrases, repetition: pRepetition } = useConnectPhrase();\n    const { kanjiList: kanji, repetition: kRepetition } = useConnectKanji();\n    const { keys: vKeys, list: vocabuStaleInfo } = useMemo(()=>getStaleSpaceRepKeys(vRepetition, vocabulary, \"[Stale Vocabulary]\"), [\n        vocabulary,\n        vRepetition\n    ]);\n    const { keys: pKeys, list: phraseStaleInfo } = useMemo(()=>getStaleSpaceRepKeys(pRepetition, phrases, \"[Stale Phrase]\"), [\n        phrases,\n        pRepetition\n    ]);\n    const { keys: kKeys, list: kanjiStaleInfo } = useMemo(()=>getStaleSpaceRepKeys(kRepetition, kanji, \"[Stale Kanji]\"), [\n        kanji,\n        kRepetition\n    ]);\n    const staleSpaceRepKeys = useMemo(()=>new Set([\n            ...vKeys,\n            ...pKeys,\n            ...kKeys\n        ]), [\n        vKeys,\n        pKeys,\n        kKeys\n    ]);\n    const staleSpaceRepTerms = useMemo(()=>staleSpaceRep([\n            ...vocabuStaleInfo,\n            ...phraseStaleInfo,\n            ...kanjiStaleInfo\n        ]), [\n        vocabuStaleInfo,\n        phraseStaleInfo,\n        kanjiStaleInfo\n    ]);\n    // Stale uids still in repetition table\n    const oldUidKanji = useMemo(()=>kanjiStaleInfo.reduce((acc, t)=>t.key === \"uid\" ? [\n                ...acc,\n                t.uid\n            ] : acc, []), [\n        kanjiStaleInfo\n    ]);\n    const oldUidPhrase = useMemo(()=>phraseStaleInfo.reduce((acc, t)=>t.key === \"uid\" ? [\n                ...acc,\n                t.uid\n            ] : acc, []), [\n        phraseStaleInfo\n    ]);\n    const oldUidVocab = useMemo(()=>vocabuStaleInfo.reduce((acc, t)=>t.key === \"uid\" ? [\n                ...acc,\n                t.uid\n            ] : acc, []), [\n        vocabuStaleInfo\n    ]);\n    const phraseDelMetaCB = useCallback(()=>{\n        if (oldUidPhrase.length > 0) {\n            void dispatch(deleteMetaPhrase(oldUidPhrase));\n        }\n    }, [\n        dispatch,\n        oldUidPhrase\n    ]);\n    const vocabDelMetaCB = useCallback(()=>{\n        if (oldUidVocab.length > 0) {\n            void dispatch(deleteMetaVocab(oldUidVocab));\n        }\n    }, [\n        dispatch,\n        oldUidVocab\n    ]);\n    const kanjiDelMetaCB = useCallback(()=>{\n        if (oldUidKanji.length > 0) {\n            void dispatch(deleteMetaKanji(oldUidKanji));\n        }\n    }, [\n        dispatch,\n        oldUidKanji\n    ]);\n    const el = /*#__PURE__*/ _jsxs(_Fragment, {\n        children: [\n            (oldUidPhrase.length > 0 || oldUidVocab.length > 0 || oldUidKanji.length > 0) && /*#__PURE__*/ _jsxs(\"div\", {\n                className: \"mb-4\",\n                children: [\n                    /*#__PURE__*/ _jsx(\"span\", {\n                        className: \"fs-3 fw-light\",\n                        children: \"Stale Metadata UID\"\n                    }),\n                    /*#__PURE__*/ _jsxs(\"div\", {\n                        className: \"d-flex flex-row justify-content-between\",\n                        children: [\n                            /*#__PURE__*/ _jsx(\"div\", {\n                                className: \"column-1\"\n                            }),\n                            /*#__PURE__*/ _jsx(\"div\", {\n                                className: \"column-2\",\n                                children: /*#__PURE__*/ _jsxs(\"div\", {\n                                    className: \"setting-block\",\n                                    children: [\n                                        oldUidPhrase.length > 0 && /*#__PURE__*/ _jsxs(\"div\", {\n                                            className: \"d-flex flex-row justify-content-between\",\n                                            children: [\n                                                /*#__PURE__*/ _jsxs(\"span\", {\n                                                    children: [\n                                                        \"Phrase: \",\n                                                        oldUidPhrase.length\n                                                    ]\n                                                }),\n                                                /*#__PURE__*/ _jsx(\"div\", {\n                                                    className: \"ps-4\",\n                                                    onClick: phraseDelMetaCB,\n                                                    children: /*#__PURE__*/ _jsx(TrashIcon, {\n                                                        className: \"clickable\",\n                                                        size: \"small\",\n                                                        \"aria-label\": \"delete\"\n                                                    })\n                                                })\n                                            ]\n                                        }),\n                                        oldUidVocab.length > 0 && /*#__PURE__*/ _jsxs(\"div\", {\n                                            className: \"d-flex flex-row justify-content-between\",\n                                            children: [\n                                                /*#__PURE__*/ _jsxs(\"span\", {\n                                                    children: [\n                                                        \"Vocabulary: \",\n                                                        oldUidVocab.length\n                                                    ]\n                                                }),\n                                                /*#__PURE__*/ _jsx(\"div\", {\n                                                    className: \"ps-4\",\n                                                    onClick: vocabDelMetaCB,\n                                                    children: /*#__PURE__*/ _jsx(TrashIcon, {\n                                                        className: \"clickable\",\n                                                        size: \"small\",\n                                                        \"aria-label\": \"delete\"\n                                                    })\n                                                })\n                                            ]\n                                        }),\n                                        oldUidKanji.length > 0 && /*#__PURE__*/ _jsxs(\"div\", {\n                                            className: \"d-flex flex-row justify-content-between\",\n                                            children: [\n                                                /*#__PURE__*/ _jsxs(\"span\", {\n                                                    children: [\n                                                        \"Kanji: \",\n                                                        oldUidKanji.length\n                                                    ]\n                                                }),\n                                                /*#__PURE__*/ _jsx(\"div\", {\n                                                    className: \"ps-4\",\n                                                    onClick: kanjiDelMetaCB,\n                                                    children: /*#__PURE__*/ _jsx(TrashIcon, {\n                                                        className: \"clickable\",\n                                                        size: \"small\",\n                                                        \"aria-label\": \"delete\"\n                                                    })\n                                                })\n                                            ]\n                                        })\n                                    ]\n                                })\n                            })\n                        ]\n                    })\n                ]\n            }),\n            /*#__PURE__*/ _jsxs(\"div\", {\n                className: \"mb-2\",\n                children: [\n                    /*#__PURE__*/ _jsxs(\"div\", {\n                        className: \"d-flex justify-content-between\",\n                        children: [\n                            /*#__PURE__*/ _jsx(\"span\", {\n                                className: \"fs-3 fw-light\",\n                                children: \"Stale Metadata Keys\"\n                            }),\n                            collapseExpandToggler(sectionStaleSpaceRep, setSectionStaleSpaceRep)\n                        ]\n                    }),\n                    /*#__PURE__*/ _jsx(\"div\", {\n                        className: \"px-4\",\n                        children: /*#__PURE__*/ _jsx(\"span\", {\n                            children: \"keys: \" + JSON.stringify(Array.from(staleSpaceRepKeys), null, 2)\n                        })\n                    }),\n                    sectionStaleSpaceRep && /*#__PURE__*/ _jsx(Suspense, {\n                        fallback: /*#__PURE__*/ _jsx(NotReady, {\n                            addlStyle: \"failed-spacerep-view\"\n                        }),\n                        children: /*#__PURE__*/ _jsx(\"div\", {\n                            className: \"failed-spacerep-view container mt-2 p-0\",\n                            children: staleSpaceRepTerms\n                        })\n                    })\n                ]\n            })\n        ]\n    });\n    return el;\n}\n/**\n * Build JSX element listing stale items\n */ function staleSpaceRep(terms) {\n    return terms.reduce((a, text, i)=>{\n        const separator = /*#__PURE__*/ _jsx(\"hr\", {}, `stale-meta-${text.uid + \"-sep-\" + i}`);\n        const row = /*#__PURE__*/ _jsxs(\"div\", {\n            className: \"row\",\n            children: [\n                /*#__PURE__*/ _jsx(\"span\", {\n                    className: \"col p-0\",\n                    children: text.key\n                }),\n                /*#__PURE__*/ _jsx(\"span\", {\n                    className: \"col p-0\",\n                    children: text.english\n                }),\n                /*#__PURE__*/ _jsx(\"span\", {\n                    className: \"col p-0 app-sm-fs-xx-small\",\n                    children: /*#__PURE__*/ _jsx(\"div\", {\n                        children: text.uid\n                    })\n                })\n            ]\n        }, text.uid + text.key + \"-\" + i);\n        return a.length > 0 && i < terms.length ? [\n            ...a,\n            separator,\n            row\n        ] : [\n            ...a,\n            row\n        ];\n    }, []);\n}\n"],"names":["SettingsStale","dispatch","sectionStaleSpaceRep","setSectionStaleSpaceRep","useState","vocabList","vocabulary","repetition","vRepetition","phraseList","phrases","pRepetition","kanjiList","kanji","kRepetition","keys","vKeys","list","vocabuStaleInfo","useMemo","pKeys","phraseStaleInfo","kKeys","kanjiStaleInfo","staleSpaceRepKeys","Set","staleSpaceRepTerms","staleSpaceRep","terms","reduce","a","text","i","separator","uid","row","className","children","key","english","length","oldUidKanji","acc","t","oldUidPhrase","oldUidVocab","phraseDelMetaCB","useCallback","vocabDelMetaCB","kanjiDelMetaCB","onClick","size","collapseExpandToggler","JSON","stringify","Array","from","Suspense","fallback","addlStyle"],"mappings":"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"}