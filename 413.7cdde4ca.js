(self.webpackChunknmemonica=self.webpackChunknmemonica||[]).push([["413"],{32454:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return L}});var l=a("59250"),t=a("53553"),i=a("55683"),n=a("50098"),c=a("83152"),r=a.n(c),o=a("17313"),d=a("92761"),m=a("4558"),u=a("82063"),h=a("761"),x=a("95504"),b=a("71036"),p=a("89760"),j=a("2929"),v=a("65166"),f=a("31218"),g=a("75168"),S=a("54753"),N=a("48726"),D=a("15247"),k=a("69795"),C=a("63383"),w=a("41978"),y=a("93835"),I=a("44465"),E=a("68650");function L(){let e=(0,d.useDispatch)(),{cookies:s,debug:a,localServiceURL:c,lastImport:L}=(0,g.useConnectSetting)(),[T,z]=(0,o.useState)(!1),[B,O]=(0,o.useState)(!1),[R,P]=(0,o.useState)(!1),[U,H]=(0,o.useState)(!1),[K,F]=(0,o.useState)(!1),[J,V]=(0,o.useState)(!1),[G,M]=(0,o.useState)(!1),W=(0,o.useCallback)(()=>{if(!confirm("User edited datasets will be overwritten"))return;let s=(0,m.getExternalSourceType)(c);s===m.ExternalSourceType.Unset?e((0,S.setLocalDataEdited)(!1)):e((0,S.setLocalDataEdited)(!0)),e((0,y.importDatasets)()).unwrap().then(s=>Promise.all(s.map(s=>{let{data:a,hash:l}=(0,i.sheetDataToJSON)(s),t=s.name.toLowerCase();return e((0,I.setVersion)({name:t,hash:l})),(0,f.swMessageSaveDataJSON)(h.dataServiceEndpoint+"/"+t+".json.v"+l,a).then(()=>s)})).then(s=>((0,x.openIDB)().then(e=>(0,x.putIDBItem)({db:e,store:x.IDBStores.WORKBOOK},{key:"0",workbook:s})),e((0,I.setSwVersions)())))).then(()=>{e((0,E.clearVocabulary)()),e((0,C.clearPhrases)()),e((0,N.clearKanji)()),e((0,k.clearParticleGame)()),e((0,D.clearOpposites)()),P(!0),e((0,S.setLastImport)(`${["Reset","Local","GitHub"][s]}: ${new Date().toJSON()}`))})},[e,c]),$=(0,o.useCallback)(()=>{confirm("User settings will be overwritten")&&e((0,S.importSettings)()).then(()=>{H(!0)})},[e]),A=(0,o.useCallback)(()=>{if(!confirm("Back up:\n - Datasets\n - Settings\n\nto local service?"))return;let s=new Promise((s,a)=>{let l;try{l=(0,v.getLocalStorageSettings)(b.localStorageKey)}catch(s){e((0,S.logger)("Failed settings backup",w.DebugLevel.ERROR))}if(!l){s();return}(0,y.saveSettingsLocalService)(l,c).then(()=>s).catch(()=>a)});Promise.all([s,e((0,y.getDatasets)()).unwrap().then(e=>e.map(e=>(0,y.saveSheetLocalService)(e,c))).then(e=>Promise.all(e))]).then(()=>{F(!0)})},[e,c]),q=(0,o.useCallback)(e=>{z(e)},[]),Q=(0,o.useCallback)(e=>{O(e),!e&&(P(null),F(null))},[]);return(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mt-3 mb-1"}),(0,l.jsxs)("div",{className:"d-flex flex-row justify-content-between",children:[(0,l.jsx)("div",{className:"column-1 mb-2 me-sm-2"}),(0,l.jsx)("div",{className:"column-2",children:(0,l.jsxs)("div",{className:"ps-2 d-flex flex-column align-items-end",children:[(0,l.jsx)("div",{className:"setting-block mb-2",children:(0,l.jsx)(u.default,{disabled:!s,active:a>w.DebugLevel.OFF,action:(0,p.buildAction)(e,S.debugToggled),color:"default",statusText:(0,j.labelOptions)(a,["Debug","Debug Error","Debug Warn","Debug"])})}),(0,l.jsxs)("div",{className:r()({"d-flex justify-content-end mb-2":!0,"disabled-color":G}),children:[(0,l.jsx)("p",{id:"hard-refresh",className:r()({"text-right":!0,"disabled-color":!s}),children:"Hard Refresh"}),(0,l.jsx)("div",{className:r()({"spin-a-bit":J,"disabled-color":!s,clickable:s}),style:{height:"24px"},"aria-labelledby":"hard-refresh",onClick:s?()=>{V(!0),M(!1),setTimeout(()=>{J&&(V(!1),M(!0))},3e3),(0,f.swMessageDoHardRefresh)()}:void 0,children:(0,l.jsx)(n.SyncIcon,{size:24,"aria-label":"Hard Refresh"})})]})," "]})})]}),(0,l.jsx)("h3",{className:"mt-3 mb-1 fw-light",children:"External Data Source"}),(0,l.jsxs)("div",{className:"d-flex flex-column flex-sm-row justify-content-between",children:[(0,l.jsx)("div",{className:"column-1 mb-2 me-sm-2",children:(0,l.jsx)("div",{className:"mt-2 mb-2",children:[(0,l.jsx)("div",{children:"Recent import history:"},"label"),...L.map(e=>(0,l.jsx)("div",{className:"pt-1",children:e},e))]})}),(0,l.jsxs)("div",{className:"column-2",children:[(0,l.jsx)("div",{className:"mb-2",children:(0,l.jsx)(m.default,{onChangeInput:q,onChangeTrust:Q})}),(0,l.jsxs)("div",{className:"d-flex justify-content-center",children:[(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Import Datasets",variant:"outlined",size:"small",disabled:T||""===c||!0!==B||!0===R,onClick:W,children:[R?(0,l.jsx)(n.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(n.DownloadIcon,{size:"small",className:"pe-1"}),"Datasets"]})}),(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Import User Configuration",variant:"outlined",size:"small",disabled:(0,m.getExternalSourceType)(c)!==m.ExternalSourceType.LocalService||T||""===c||!B||!0===U,onClick:$,children:[U?(0,l.jsx)(n.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(n.DownloadIcon,{size:"small",className:"pe-1"}),"Config"]})}),(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Backup Datasets",variant:"outlined",size:"small",disabled:(0,m.getExternalSourceType)(c)!==m.ExternalSourceType.LocalService||T||""===c||!0!==B||!0===K,onClick:A,children:[K?(0,l.jsx)(n.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(n.UploadIcon,{size:"small",className:"pe-1"}),"Backup"]})})]})]})]})]})}}}]);
//# sourceMappingURL=413.7cdde4ca.js.map