(self.webpackChunknmemonica=self.webpackChunknmemonica||[]).push([["625"],{68152:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return y}});var l=a("17581"),t=a("15764"),i=a("50098"),c=a("18554"),n=a.n(c),r=a("74288"),o=a("75092"),d=a("69017"),m=a("86484"),u=a("35018"),h=a("71959"),x=a("90210"),b=a("27068"),p=a("97453"),j=a("96486"),f=a("45080"),v=a("1536"),g=a("31980"),S=a("40257"),N=a("97648"),k=a("57390"),D=a("12960"),C=a("84798"),w=a("87519");function y(){let e=(0,o.useDispatch)(),{cookies:s,debug:a,localServiceURL:c,lastImport:y}=(0,f.useConnectSetting)(),[I,E]=(0,r.useState)(!1),[L,z]=(0,r.useState)(!1),[B,T]=(0,r.useState)(!1),[R,O]=(0,r.useState)(!1),[P,U]=(0,r.useState)(!1),[H,K]=(0,r.useState)(!1),[F,G]=(0,r.useState)(!1),W=(0,r.useCallback)(()=>{if(!confirm("User edited datasets will be overwritten"))return;let s=(0,d.getExternalSourceType)(c);s===d.ExternalSourceType.Unset?e((0,v.setLocalDataEdited)(!1)):e((0,v.setLocalDataEdited)(!0)),e((0,C.importDatasets)()).unwrap().then(e=>(0,u.openIDB)().then(s=>(0,u.putIDBItem)({db:s,store:u.IDBStores.WORKBOOK},{key:"0",workbook:e}))).then(()=>{e((0,w.clearVocabulary)()),e((0,k.clearPhrases)()),e((0,g.clearKanji)()),e((0,N.clearParticleGame)()),e((0,S.clearOpposites)()),O(!0),e((0,v.setLastImport)(`${["Reset","Local","GitHub"][s]}: ${new Date().toJSON()}`))})},[e,c]),$=(0,r.useCallback)(()=>{confirm("User settings will be overwritten")&&e((0,v.importSettings)()).then(()=>{U(!0)})},[e]),A=(0,r.useCallback)(()=>{if(!confirm("Back up:\n - Datasets\n - Settings\n\nto local service?"))return;let s=new Promise((s,a)=>{let l;try{l=(0,p.getLocalStorageSettings)(h.localStorageKey)}catch(s){e((0,v.logger)("Failed settings backup",D.DebugLevel.ERROR))}if(!l){s();return}(0,C.saveSettingsLocalService)(l,c).then(()=>s).catch(()=>a)});Promise.all([s,e((0,C.getDatasets)()).unwrap().then(e=>e.map(e=>(0,C.saveSheetLocalService)(e,c))).then(e=>Promise.all(e))]).then(()=>{T(!0)})},[e,c]),J=(0,r.useCallback)(e=>{E(e)},[]),M=(0,r.useCallback)(e=>{z(e),!e&&(O(null),T(null))},[]);return(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mt-3 mb-1"}),(0,l.jsxs)("div",{className:"d-flex flex-row justify-content-between",children:[(0,l.jsx)("div",{className:"column-1 mb-2 me-sm-2"}),(0,l.jsx)("div",{className:"column-2",children:(0,l.jsxs)("div",{className:"ps-2 d-flex flex-column align-items-end",children:[(0,l.jsx)("div",{className:"setting-block mb-2",children:(0,l.jsx)(m.default,{disabled:!s,active:a>D.DebugLevel.OFF,action:(0,x.buildAction)(e,v.debugToggled),color:"default",statusText:(0,b.labelOptions)(a,["Debug","Debug Error","Debug Warn","Debug"])})}),(0,l.jsxs)("div",{className:n()({"d-flex justify-content-end mb-2":!0,"disabled-color":F}),children:[(0,l.jsx)("p",{id:"hard-refresh",className:n()({"text-right":!0,"disabled-color":!s}),children:"Hard Refresh"}),(0,l.jsx)("div",{className:n()({"spin-a-bit":H,"disabled-color":!s,clickable:s}),style:{height:"24px"},"aria-labelledby":"hard-refresh",onClick:s?()=>{K(!0),G(!1),setTimeout(()=>{H&&(K(!1),G(!0))},3e3),(0,j.swMessageDoHardRefresh)()}:void 0,children:(0,l.jsx)(i.SyncIcon,{size:24,"aria-label":"Hard Refresh"})})]})," "]})})]}),(0,l.jsx)("h3",{className:"mt-3 mb-1 fw-light",children:"External Data Source"}),(0,l.jsxs)("div",{className:"d-flex flex-column flex-sm-row justify-content-between",children:[(0,l.jsx)("div",{className:"column-1 mb-2 me-sm-2",children:(0,l.jsx)("div",{className:"mt-2 mb-2",children:[(0,l.jsx)("div",{children:"Recent import history:"},"label"),...y.map(e=>(0,l.jsx)("div",{className:"pt-1",children:e},e))]})}),(0,l.jsxs)("div",{className:"column-2",children:[(0,l.jsx)("div",{className:"mb-2",children:(0,l.jsx)(d.default,{onChangeInput:J,onChangeTrust:M})}),(0,l.jsxs)("div",{className:"d-flex justify-content-center",children:[(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Import Datasets",variant:"outlined",size:"small",disabled:I||""===c||!0!==L||!0===R,onClick:W,children:[R?(0,l.jsx)(i.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(i.DownloadIcon,{size:"small",className:"pe-1"}),"Datasets"]})}),(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Import User Configuration",variant:"outlined",size:"small",disabled:(0,d.getExternalSourceType)(c)!==d.ExternalSourceType.LocalService||I||""===c||!L||!0===P,onClick:$,children:[P?(0,l.jsx)(i.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(i.DownloadIcon,{size:"small",className:"pe-1"}),"Config"]})}),(0,l.jsx)("div",{className:"px-1",children:(0,l.jsxs)(t.Button,{"aria-label":"Backup Datasets",variant:"outlined",size:"small",disabled:(0,d.getExternalSourceType)(c)!==d.ExternalSourceType.LocalService||I||""===c||!0!==L||!0===B,onClick:A,children:[B?(0,l.jsx)(i.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,l.jsx)(i.UploadIcon,{size:"small",className:"pe-1"}),"Backup"]})})]})]})]})]})}}}]);
//# sourceMappingURL=625.fa0dccf9.js.map